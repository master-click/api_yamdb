# Проект «API для Yatube»

## Макарьев Никита, Батова Ольга, Зимаков Максим 

***
Задача проекта заключается в приобретении практических навыков командной работы с **Django REST framework**.

***
### Техническое описание. ###

Проект **YaMDb** собирает **отзывы (Review)** пользователей на **произведения (Title)**. Произведения делятся на категории: «Книги», «Фильмы», «Музыка». Список **категорий (Category)** может быть расширен администратором (например, можно добавить категорию «Изобразительное искусство» или «Ювелирка»).

К проекту по адресу **http://127.0.0.1:8000/redoc/** подключена документация **API YaMDb**. В ней описаны возможные запросы к API и структура ожидаемых ответов. Для каждого запроса указаны уровни прав доступа: пользовательские роли, которым разрешён запрос.

Произведению может быть присвоен жанр **Genre** из списка предустановленных (например, «Сказка», «Рок» или «Артхаус»). Новые жанры может создавать только администратор.

Благодарные или возмущённые пользователи оставляют к произведениям текстовые **отзывы (Review)** и ставят произведению оценку в диапазоне от одного до десяти (целое число); из пользовательских оценок формируется усреднённая оценка произведения — **рейтинг** (целое число). На одно произведение пользователь может оставить только один отзыв.

***
### Пользовательские роли ###

  - Аноним — может просматривать описания произведений, читать отзывы и комментарии.
  - Аутентифицированный пользователь (user) — может читать всё, как и Аноним, может публиковать отзывы и ставить оценки произведениям (фильмам/книгам/песенкам), может комментировать отзывы; может редактировать и удалять свои отзывы и комментарии, редактировать свои оценки произведений. Эта роль присваивается по умолчанию каждому новому пользователю.
  - Модератор (moderator) — те же права, что и у Аутентифицированного пользователя, плюс право удалять и редактировать любые отзывы и комментарии.
  - Администратор (admin) — полные права на управление всем контентом проекта. Может создавать и удалять произведения, категории и жанры. Может назначать роли пользователям.
  - Суперюзер Django — обладает правами администратора (admin).

***

### Алгоритм регистрации пользователей ###


1. Для добавления нового пользователя нужно отправить POST-запрос с параметрами email и username на эндпоинт /api/v1/auth/signup/.
2. Сервис YaMDB отправляет письмо с кодом подтверждения (confirmation_code) на указанный адрес email.
3. Пользователь отправляет POST-запрос с параметрами username и confirmation_code на эндпоинт /api/v1/auth/token/, в ответе на запрос ему приходит token (JWT-токен).

В результате пользователь получает токен и может работать с API проекта, отправляя этот токен с каждым запросом.

После регистрации и получения токена пользователь может отправить PATCH-запрос на эндпоинт /api/v1/users/me/ и заполнить поля в своём профайле (описание полей — в документации).

***

### Создание пользователя администратором ###
1. Пользователя может создать администратор — через админ-зону сайта или через POST-запрос на специальный эндпоинт api/v1/users/ (описание полей запроса для этого случая — в документации). В этот момент письмо с кодом подтверждения пользователю отправлять не нужно.

2. После этого пользователь должен самостоятельно отправить свой email и username на эндпоинт /api/v1/auth/signup/ , в ответ ему должно прийти письмо с кодом подтверждения.

3. Далее пользователь отправляет POST-запрос с параметрами username и confirmation_code на эндпоинт /api/v1/auth/token/, в ответе на запрос ему приходит token (JWT-токен), как и при самостоятельной регистрации.

***


### Разворачивание проекта: ###


Клонировать репозиторий и перейти в его папку в командной строке:

```bash
git clone https://github.com/NikitaMackariev/api_yamdb.git
```


```bash
cd api_yamdb
```


Cоздать и активировать виртуальное окружение:


```bash
python3 -m venv venv
```


Для *nix-систем:


```bash
. venv/bin/activate
```


Для windows-систем:


```bash 
. venv/Scripts/activate
```


Установить зависимости из файла requirements.txt:

```bash
python -m pip install --upgrade pip
pip install -r requirements.txt
```

Выполнить миграции:


```bash 
cd api_yamdb
python manage.py makemigrations
python manage.py migrate
```

Запустить проект:


```bash
python manage.py runserver
```


Создать суперпользователя django:


```bash 
python manage.py createsuperuser
```


Придумайте логин (например, admin):

```bash
Username (leave blank to use 'user'):
```


Укажите почту:
```bash
Email address:
```


Придумайте пароль:

```bash
Password:
```


Повторите пароль:

```bash
Password (again):
```


Суперпользователь успешно создан:

```bash
Superuser created successfully.
```


Сам проект и админ-панель доступны по адресам:


```
http://127.0.0.1:8000
http://127.0.0.1:8000/admin
```
***
### Некоторые примеры запросов к API. ###

**Регистрация нового пользователя:**

Получить код подтверждения на переданный e-mail.

эндпойнт:

```
/api/v1/auth/signup/
```

HTTP-метод:

```
POST
```
Payload:
```python
{
  "email": "string",
  "username": "string"
}
```
Варианты ответов:
* удачное выполнение запроса: статус 200 
```python
{
  "email": "string",
  "username": "string"
}
```

* запрос отклонен: статус 400 - отсутствует обязательное поле или оно некорректно
```python
{
  "email": [
    "Обязательное поле."
  ]
}
```

**Получение JWT-токена:**

Получение JWT-токена в обмен на username и confirmation code.

эндпойнт:

```
/api/v1/auth/token/
```

HTTP-метод:

```
POST
```
Payload:
```python
{
  "username": "string",
  "confirmation_code": "string"
}
```
Варианты ответов:
* удачное выполнение запроса: статус 200 
```python
{
  "token": "string"
}
```

* запрос отклонен: статус 400 - отсутствует обязательное поле или оно некорректно
```python
{
  "confirmation_code": [
    "Обязательное поле."
  ]
}
```

* запрос отклонен: статус 403 - пользователь не найден
```python
{
  "username": [
    "Пользователь с таким именем не найден"
  ]
}
```

**Добавление новой категории**

Права доступа: **Администратор**.

эндпойнт:
```
/api/v1/categories/
```

HTTP-метод:
```
POST
```

Payload:
```python
{
  "name": "string",
  "slug": "string"
}
```

Варианты ответов:
* удачное выполнение запроса: статус 201 
```python
{
  "name": "string",
  "slug": "string"
}
```

* запрос отклонен: статус 400 - отсутствует обязательное поле или оно некорректно
```python
{
  "slug": [
    "Обязательное поле."
  ]
}
```

* запрос отклонен: статус 401 - необходим Jwt-токен
```python
{
  "detail": "Учетные данные не были предоставлены."
}
```

* запрос отклонен: статус 403 - нет прав доступа
```python
{
  "detail": "Нет прав доступа."
}
```

**Получение списка жанров:**

эндпойнт:

```
/api/v1/genres/
```

HTTP-метод:

```
GET
```

в ответе:

```python
[
  {
    "count": 0,
    "next": "string",
    "previous": "string",
    "results": [
      {
        "name": "string",
        "slug": "string"
      }
    ]
  }
]
```

**Частичное обновление отзыва по id**

Права доступа: **Автор отзыва, модератор или администратор.**.

эндпойнт:
```
/api/v1/titles/{title_id}/reviews/{review_id}/
```

HTTP-метод:
```
PATCH
```

Payload:
```python
{
  "text": "string",
  "score": 1
}
```

Варианты ответов:
* удачное выполнение запроса: статус 200
```python
{
  "id": 0,
  "text": "string",
  "author": "string",
  "score": 1,
  "pub_date": "2019-08-24T14:15:22Z"
}
```

* запрос отклонен: статус 400 - отсутствует обязательное поле или оно некорректно
```python
{
  "text": [
    "Обязательное поле."
  ]
}
```

* запрос отклонен: статус 401 - необходим Jwt-токен
```python
{
  "detail": "Учетные данные не были предоставлены."
}
```

* запрос отклонен: статус 403 - нет прав доступа
```python
{
  "detail": "Нет прав доступа."
}
```

* запрос отклонен: статус 404 - произведение не найдено
```python
{
  "detail": "Произведение не найдено."
}
```

***

### Распределение задач в команде ###


* Макарьев Никита | Github: https://github.com/NikitaMackariev |  Кастомная модель User, регистрация и аутентификация пользователей.
* Ольга Батова | Github:https://github.com/master-click | Жанры (Genres) и произведения (Titles): модели, представления и эндпойнты для них.
* Максим Зимаков | Github: https://github.com/Maxim-Zima | Отзывы (Review) и комментарии (Comments): модели, представления, настройка эндпойнтов. 
